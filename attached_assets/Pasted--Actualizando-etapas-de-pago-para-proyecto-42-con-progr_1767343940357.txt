ğŸ”„ Actualizando etapas de pago para proyecto 42 con progreso 50%
ğŸ“Š Etapas encontradas: 4
âœ… Activando 1 etapa(s) de pago
ğŸ’° Etapa "Pre-entrega - 90% Completado" ahora disponible para pago
ğŸ“§ Enviando email a: alfagroupstoreok@gmail.com, Asunto: ğŸ’° Nueva Etapa de Pago Disponible: Barbershop - Pre-entrega - 90% Completado
ğŸ“§ Email enviado exitosamente a: alfagroupstoreok@gmail.com
ğŸ“§ Email de nueva etapa disponible enviado a: alfagroupstoreok@gmail.com para "Pre-entrega - 90% Completado"
ğŸ”” NotificaciÃ³n in-app enviada al cliente 2
âœ… Etapas de pago actualizadas para proyecto 42 con progreso 50%
8:50:34 AM [express] PUT /api/projects/42/timeline/195 200 in 4231ms :: {"id":195,"projectId":42,"tiâ€¦
8:50:35 AM [express] GET /api/public/company-info 304 in 135ms :: {"companyName":"SOFTWAREPAR","tituâ€¦
8:50:35 AM [express] GET /api/portfolio 304 in 135ms :: [{"id":7,"title":"BaberShop","description":"â€¦
8:50:35 AM [express] GET /api/hero-slides 304 in 404ms :: [{"id":1,"title":"SoftwarePar: Tu Partner â€¦
8:50:35 AM [express] GET /api/work-modalities 304 in 404ms :: [{"id":6,"title":"Lanzamiento Web","suâ€¦
8:50:35 AM [express] GET /api/projects/42/timeline 200 in 270ms :: [{"id":193,"projectId":42,"title"â€¦
8:50:36 AM [express] GET /api/admin/projects 200 in 271ms :: [{"id":42,"name":"Barbershop","descriptâ€¦
8:50:36 AM [express] GET /api/admin/projects/stats 304 in 554ms :: {"pending":"0","inProgress":"0","â€¦
ğŸ” Login attempt for: alfagroupstoreok@gmail.com
ğŸ” reCAPTCHA verified - Score: 0.9, Success: true
âœ… reCAPTCHA verified for: alfagroupstoreok@gmail.com
ğŸ‘¤ User found: { email: 'alfagroupstoreok@gmail.com', role: 'client', isActive: true }
âœ… Password valid for: alfagroupstoreok@gmail.com
âœ… Login successful for: alfagroupstoreok@gmail.com - Role: client
8:50:47 AM [express] POST /api/auth/login 200 in 517ms :: {"user":{"id":2,"email":"alfagroupstoreok@â€¦
8:50:48 AM [express] GET /api/projects 200 in 532ms :: [{"id":42,"name":"Barbershop","description":"â€¦
âœ… New WebSocket connection established
New WebSocket connection
8:50:48 AM [express] GET /api/auth/me 304 in 135ms :: {"id":2,"email":"alfagroupstoreok@gmail.com","â€¦
ğŸ”Œ WebSocket connection closed
WebSocket connection closed
Received WebSocket message: { type: 'ping' }
âœ… New WebSocket connection established
New WebSocket connection
Received WebSocket message: { type: 'auth', userId: 2, token: null }
ğŸ” WebSocket authentication attempt: { userId: 2, hasToken: false }
âœ… User registered on WebSocket: 2
Received WebSocket message: { type: 'ping' }
âœ… New WebSocket connection established
New WebSocket connection
Received WebSocket message: { type: 'auth', userId: 2, token: null }
ğŸ” WebSocket authentication attempt: { userId: 2, hasToken: false }
âœ… User registered on WebSocket: 2
Received WebSocket message: { type: 'ping' }
8:50:55 AM [express] GET /api/projects/42/payment-stages 200 in 570ms :: [{"id":135,"projectId":42,"â€¦
8:50:56 AM [express] GET /api/projects/42 200 in 799ms :: {"id":42,"name":"Barbershop","description"â€¦
8:50:57 AM [express] GET /api/exchange-rate 304 in 137ms :: {"id":17,"usdToGuarani":"6783.54","updatâ€¦
ğŸ’° Processing payment confirmation for stage 137: {
  paymentMethod: 'Mango (TU FINANCIERA)',
  hasFile: false,
  fileName: undefined,
  fileSize: undefined,
  mimetype: undefined
}
ğŸ”„ Enviando evento en tiempo real a usuario 1: {
  eventType: 'payment_proof_uploaded',
  eventData: {
    stageId: 137,
    projectId: 42,
    clientId: 2,
    stageName: 'Pre-entrega - 90% Completado',
    paymentMethod: 'Mango (TU FINANCIERA)'
  }
}
ğŸ“¡ Encontradas 3 conexiones para usuario 1
âœ… Evento payment_proof_uploaded enviado por WebSocket a usuario 1
âœ… Evento payment_proof_uploaded enviado por WebSocket a usuario 1
âœ… Evento payment_proof_uploaded enviado por WebSocket a usuario 1
â„¹ï¸ No attachment provided for stage 137
ğŸ“§ Enviando notificaciÃ³n de comprobante al admin para Pablo
ğŸ“§ Enviando email a: softwarepar.lat@gmail.com, Asunto: ğŸ‰ Comprobante de pago recibido: Barbershop - Pre-entrega - 90% Completado ($125.00)
ğŸ“§ Email enviado exitosamente a: softwarepar.lat@gmail.com
ğŸ“§ Enviando confirmaciÃ³n de comprobante al cliente: alfagroupstoreok@gmail.com
ğŸ“§ Enviando email a: alfagroupstoreok@gmail.com, Asunto: Comprobante recibido: Barbershop - Pre-entrega - 90% Completado
ğŸ“§ Email enviado exitosamente a: alfagroupstoreok@gmail.com
ğŸ“§ Email notifications sent for Pablo's payment
8:51:04 AM [express] POST /api/payment-stages/137/confirm-payment 200 in 5001ms :: {"id":137,"projecâ€¦
ğŸ”Œ WebSocket connection closed
WebSocket connection closed
âœ… New WebSocket connection established
New WebSocket connection
8:51:12 AM [express] GET /api/admin/partners 304 in 796ms :: []
8:51:12 AM [express] GET /api/admin/partners/stats 304 in 1089ms :: {"totalPartners":0,"activePartneâ€¦
ğŸ”Œ WebSocket connection closed
WebSocket connection closed
âœ… New WebSocket connection established
New WebSocket connection
Received WebSocket message: { type: 'auth', userId: 1, token: null }
ğŸ” WebSocket authentication attempt: { userId: 1, hasToken: false }
âœ… User registered on WebSocket: 1
âœ… New WebSocket connection established
New WebSocket connection
Received WebSocket message: { type: 'auth', userId: 1, token: null }
ğŸ” WebSocket authentication attempt: { userId: 1, hasToken: false }
âœ… User registered on WebSocket: 1
âœ… New WebSocket connection established
New WebSocket connection
Received WebSocket message: { type: 'auth', userId: 1, token: null }
ğŸ” WebSocket authentication attempt: { userId: 1, hasToken: false }
âœ… User registered on WebSocket: 1
âœ… New WebSocket connection established
New WebSocket connection
Received WebSocket message: { type: 'auth', userId: 1, token: null }
ğŸ” WebSocket authentication attempt: { userId: 1, hasToken: false }
âœ… User registered on WebSocket: 1
âœ… New WebSocket connection established
New WebSocket connection
Received WebSocket message: { type: 'auth', userId: 1, token: null }
ğŸ” WebSocket authentication attempt: { userId: 1, hasToken: false }
âœ… User registered on WebSocket: 1
âœ… New WebSocket connection established
New WebSocket connection
Received WebSocket message: { type: 'auth', userId: 1, token: null }
ğŸ” WebSocket authentication attempt: { userId: 1, hasToken: false }
âœ… User registered on WebSocket: 1
ğŸ”Œ WebSocket connection closed
WebSocket connection closed
ğŸ”Œ WebSocket connection closed
WebSocket connection closed
ğŸ”Œ WebSocket connection closed
WebSocket connection closed
ğŸ”Œ WebSocket connection closed
WebSocket connection closed
ğŸ”Œ WebSocket connection closed
WebSocket connection closed
ğŸ”Œ WebSocket connection closed
WebSocket connection closed
ğŸ”Œ WebSocket connection closed
WebSocket connection closed
ğŸ”Œ WebSocket connection closed
WebSocket connection closed
Received WebSocket message: { type: 'ping' }
Received WebSocket message: { type: 'ping' }
8:51:31 AM [express] GET /api/auth/me 304 in 400ms :: {"id":1,"email":"softwarepar.lat@gmail.com","fâ€¦
8:51:32 AM [express] GET /api/admin/projects 304 in 539ms :: [{"id":42,"name":"Barbershop","descriptâ€¦
âœ… New WebSocket connection established
New WebSocket connection
Received WebSocket message: { type: 'auth', userId: 1, token: null }
ğŸ” WebSocket authentication attempt: { userId: 1, hasToken: false }
âœ… User registered on WebSocket: 1
8:51:32 AM [express] GET /api/admin/projects/stats 304 in 804ms :: {"pending":"0","inProgress":"0","â€¦
8:51:36 AM [express] GET /api/projects/42/payment-stages 200 in 270ms :: [{"id":135,"projectId":42,"â€¦
âœ… Admin approving payment for stage: 137
ğŸ’± Saving exchange rate at the time of payment: 1 USD = 6783.54 PYG for stage 137
ğŸ“§ Enviando email a: alfagroupstoreok@gmail.com, Asunto: âœ… Pago Aprobado: Barbershop - Pre-entrega - 90% Completado
ğŸ“§ Email enviado exitosamente a: alfagroupstoreok@gmail.com
ğŸ“§ Email de pago aprobado enviado a cliente: alfagroupstoreok@gmail.com
ğŸ”„ Enviando evento en tiempo real a usuario 2: {
  eventType: 'payment_approved',
  eventData: {
    stageId: 137,
    projectId: 42,
    stageName: 'Pre-entrega - 90% Completado'
  }
}
ğŸ“¡ Encontradas 2 conexiones para usuario 2
âœ… Evento payment_approved enviado por WebSocket a usuario 2
âœ… Evento payment_approved enviado por WebSocket a usuario 2
ğŸ”„ Enviando evento en tiempo real a usuario 1: {
  eventType: 'payment_approved',
  eventData: {
    stageId: 137,
    projectId: 42,
    clientId: 2,
    stageName: 'Pre-entrega - 90% Completado'
  }
}
ğŸ“¡ Encontradas 1 conexiones para usuario 1
âœ… Evento payment_approved enviado por WebSocket a usuario 1
ğŸ“„ Generating invoice for stage 137...
âœ… Invoice created: 001-001-0000027
8:51:43 AM [express] POST /api/payment-stages/137/approve-payment 200 in 4159ms :: {"id":137,"projecâ€¦
ğŸ”„ Starting FacturaSend process for invoice 001-001-0000027...
âš ï¸  No se pudieron obtener catÃ¡logos de FacturaSend. Usando AsunciÃ³n por defecto.
âš ï¸  IMPORTANTE: Esto puede causar rechazo si el cliente no es de AsunciÃ³n.
ğŸ’¬ ObservaciÃ³n enviada a FacturaSend: Tipo de cambio: 1 USD = 6.783,54 PYG. Monto original: USD 125.00
ğŸ“¤ Sending to FacturaSend...
ğŸ“¤ Enviando factura a FacturaSend...
ğŸ“‹ Datos: {
  numero: 27,
  cliente: 'ALFA GROUP STORE',
  precioSinIVA: 770857,
  ivaBase: 770857,
  totalCalculado: 847943,
  montoPagado: 847943,
  moneda: 'PYG'
}
ğŸ“¦ Payload completo: [
  {
    "tipoDocumento": 1,
    "establecimiento": 1,
    "punto": 1,
    "numero": 27,
    "fecha": "2026-01-02T08:51:44",
    "tipoEmision": 1,
    "tipoTransaccion": 2,
    "tipoImpuesto": 1,
    "moneda": "PYG",
    "observacion": "Tipo de cambio: 1 USD = 6.783,54 PYG. Monto original: USD 125.00",
    "cliente": {
      "contribuyente": true,
      "razonSocial": "ALFA GROUP STORE",
      "tipoOperacion": 1,
      "direccion": "Barrio Residencial â€“ Carlos A. LÃ³pez â€“ ItapÃºa",
      "numeroCasa": "0",
      "departamento": 1,
      "departamentoDescripcion": "CAPITAL",
      "distrito": 1,
      "distritoDescripcion": "ASUNCION",
      "pais": "PRY",
      "paisDescripcion": "Paraguay",
      "tipoContribuyente": 2,
      "telefono": "+595985990044",
      "celular": "+595985990044",
      "email": "alfagroupstoreok@gmail.com",
      "codigo": "002",
      "ciudad": 1,
      "ciudadDescripcion": "ASUNCION",
      "ruc": "80000000-1"
    },
    "usuario": {
      "documentoTipo": 1,
      "documentoNumero": "4220058",
      "nombre": "BENITEZ DE LA CRUZ JHONI FABIAN",
      "cargo": "Propietario"
    },
    "factura": {
      "presencia": 2
    },
    "condicion": {
      "tipo": 1,
      "entregas": [
        {
          "tipo": 9,
          "monto": 847943,
          "moneda": "PYG"
        }
      ]
    },
    "items": [
      {
        "descripcion": "Pre-entrega - 90% Completado",
        "cantidad": 1,
        "unidadMedida": 77,
        "precioUnitario": 770857,
        "ivaTipo": 1,
        "ivaBase": 770857,
        "ivaProporcion": 100
      }
    ]
  }
]
ğŸš€ URL FINAL ENVIADA: https://api.facturasend.com.py/jhonifabianbenitezdelacruz_7451/lote/create?xml=true&qr=true
ğŸ“¤ Headers enviados:
  - Content-Type: application/json; charset=utf-8
  - Authorization: Bearer api_key_[CONFIGURADO]
  - API Key length: 36
ğŸ“¥ Response status: 200
ğŸ“¥ Response body: {"success":false,"error":"Algun/os error/es no permitio/tieron generar el XML del documento electrÃ³nico","errores":[{"index":0,"error":"Valor invalido \"iva\"=undefined proporcionado en data.items[0].iva"}]}
âŒ FacturaSend rechazÃ³ la factura: {
  success: false,
  error: 'Algun/os error/es no permitio/tieron generar el XML del documento electrÃ³nico',
  errores: [
    {
      index: 0,
      error: 'Valor invalido "iva"=undefined proporcionado en data.items[0].iva'
    }
  ]
}
âœ… Invoice updated with FacturaSend data:
   ğŸ“‹ CDC: Not available
   ğŸ“± QR URL: Not available
   ğŸ“Š Status: rechazado
   ğŸ“ Protocol: null
âŒ FacturaSend: RECHAZADO
ğŸ’¬ Message: Algun/os error/es no permitio/tieron generar el XML del documento electrÃ³nico
8:51:45 AM [express] GET /api/projects/42/payment-stages 200 in 270ms :: [{"id":135,"projectId":42,"â€¦
8:51:47 AM [express] GET /api/projects/42/payment-stages 304 in 269ms :: [{"id":135,"projectId":42,"â€¦
8:51:47 AM [express] GET /api/projects/42/payment-stages 304 in 270ms :: [{"id":135,"projectId":42,"â€¦